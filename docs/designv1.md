# Tauri+React 桌面Todo工具设计方案

本方案基于标准模式、固定模式的核心需求，结合**命令化设计**、**云同步插件化**、**高可扩展**的设计原则，明确了工具的核心功能、技术架构、交互设计及数据结构定义，第一版聚焦Windows端基础能力实现，预留全链路扩展接口。

## 一、核心功能与交互设计

### 1.1 模式定义与视觉体验

- 固定模式（Widget Mode）：
  - 定位：模拟“桌面底层挂件”，作为壁纸的一部分，不遮挡视线。
  - 特性：支持全透明背景、内容透明度（0-100%）调节、点击穿透（预留）。
- 标准模式（Standard Mode）：
  - 定位：标准 Windows 窗口，用于深度配置与复杂任务编辑。
  - 特性：支持极简风暗黑/浅色主题切换，支持系统主题跟随。
- 交互逻辑：两模式支持一键热切换，无需重启；支持双模式共存（如：标准模式编辑，固定模式实时预览）。

### 1.2 任务模型

- task：任务。包含id、version、状态、日志、创建时间、更新时间、关闭时间。
  - delay task：延期任务，它不能直接作为global的子项。task包含0-n个delay task。
  - 状态更新：Task 允许手动标记完成；其关联的所有 Delay 任务均标记完成时进行“询问确认”。自身标记完成后，所有Delay任务均标记完成。
  - 任务被标记完成后，自动更新关闭时间
- log：日志。用于记录task的过程，每个日志都可以关联一个task。日志共有exception、simple、spark、conclusion四种类型。每条日志都有独立的id、version、类型、内容、关联的taskid、创建时间、更新时间。
  - exception：异常事项，需要关联具体的 Task。
  - simple：普通记录，需要关联具体的 Task。
  - spark：灵感/闪念记录，可以不关联具体的 Task。
  - conclusion：任务完成总结，需要关联具体的 Task。
- global：目标。用于分组管理任务。每个global有多个task，它包含全局唯一id、状态、创建时间、修改时间、描述。
  - 当 Global 被标记为“完成”或“终止”时，系统应弹窗询问“是否同时关闭关联的 X 个未完成任务？”
- tag：标签。用于对任务进行分类。每个任务可以添加多个标签，标签之间用逗号隔开。
- task status：任务状态。包含完成/未完成两种状态。

### 1.3 UI模型

- 样式
  - task为蓝色，delay为橙色
  - exception为红色，simple为白色，spark为绿色，conclusion为紫色
  - 完成的task使用删除线标记
- 固定模式
  - 只展示todo列表，仅支持以下排序方式：完成情况排序、优先级排序
  - 只展示task与delay，使用不同颜色区分，task为蓝色，delay为橙色。
  - 如果该任务有关联的 exception log，在任务文案前加一个红色的感叹号 (!)
- 标准模式
  - global展示页面
  - global有一个独立的编辑页面，在此页面下支持编辑task、delay task、log
  - task查找页面，通过日历的时间选择功能过滤当天的task
  - task关联页面，展示task关联的delay task、log
  - 在标准模式下点击“完成”时，输入框可以自动变为 conclusion 模式
  - 时光机页面，用于统计任务情况
- 归档
  - 当 global 状态标记为“已完成”时，系统弹窗询问：“是否将该目标下的所有数据移入归档？
  - 新增Inbox的默认容器，对于不属于任何目标的散乱任务或灵感，可以按时间维度（如按月）进行归档。
  - 进入归档的数据应变为“只读”状态，防止无意间的修改破坏历史记录。如果需要修改，必须先执行“激活/还原”操作。
  - 在归档时，可以将任务的“关键词”提取出来，存在主索引文件里

### 1.4 功能细节

- 固定模式的“桌面穿透”细节
  - 层级管理：在 Tauri 中，固定模式需要调用 WinAPI 设置为 WS_EX_NOACTIVATE 或类似属性，确保它在 Win+D 回到桌面时依然可见，且不会在 Alt+Tab 中干扰用户。
  - 点击穿透：是否允许用户在固定模式下直接勾选 Todo？如果是，则不能开启全穿透。增加“锁定/解锁”状态切换。
  - 穿透支持热键，解锁状态下，窗口需要提供视觉反馈。
- 异常处理与鲁棒性
  - JSON 损坏恢复：如果 data.json 解析失败（如断电导致文件写入一半），系统应自动尝试从最新的 SQLite 备份中提取数据并回滚。
  - 版本兼容性：在 LocalStorageRoot 中增加一个 schemaVersion。当未来修改数据结构时，可以编写迁移脚本（Migration）升级老数据。
- 任务状态更新
  - 允许自定义状态更新策略：启动时检查、手动触发、定时检查

## 二、技术栈选型

### 2.1 前端

- 框架核心：Vite + React + material-ui（组件库，提供基础组件和样式）
- 样式方案：Tailwind CSS（适配透明/对比度调节，兼容Paico AI生成UI，极简风易实现）；
- 状态管理：Zustand

### 2.2 后端

- 核心框架：Tauri v2
- 关键插件：fs（本地文件读写）、os（系统信息获取）、globalShortcut（全局快捷键）、http（网络请求，预留同步能力）；

### 2.3 存储

- 主存储：JSON文件（存储路径`%APPDATA%/todo-desktop/data.json`，满足手动修改便捷性，天然适配增量同步）；
- 兜底保障：SQLite（Tauri内置，每次JSON修改前自动备份，防止格式错误导致数据丢失）；
- 窗口配置：开启透明/无装饰/桌面最底层，支持窗口大小调整、状态持久化（记住上次窗口位置/大小/模式）。
- 日志存储：独立JSON日志文件，按**标准化命令格式**记录核心操作，不存储原始数据变更。

